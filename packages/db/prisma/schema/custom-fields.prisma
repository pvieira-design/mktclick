// Enum for Custom Field Types
enum FieldType {
  TEXT           // Short text input
  TEXTAREA       // Long text input
  WYSIWYG        // Rich text editor (Novel)
  FILE           // File upload (Vercel Blob)
  DATE           // Date picker
  DATETIME       // DateTime picker
  SELECT         // Dropdown with options (single)
  MULTI_SELECT   // Multiple selection from options (checkbox group)
  NUMBER         // Numeric input
  CHECKBOX       // Boolean checkbox
  URL            // URL/Link input
  IMAGE          // Image upload with inline preview
  REPEATER       // Repeatable group of sub-fields (options stores sub-field schema)
  AD_REFERENCE   // Reference to Ad (future)
}

// ContentTypeField Model - Custom fields configuration per ContentType
model ContentTypeField {
  id             String      @id @default(cuid())
  contentTypeId  String
  name           String      // camelCase field name (e.g., "titulo", "descricao")
  label          String      // Display label (e.g., "Titulo", "Descricao")
  fieldType      FieldType
  required       Boolean     @default(false)
  order          Int         @default(0)
  options        Json?       // For SELECT: ["option1", "option2"]
  placeholder    String?
  helpText       String?
  defaultValue   String?
  isActive       Boolean     @default(true)
  assignedStepId String?     // Optional: which workflow step this field is assigned to
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  
  // Relations
  contentType    ContentType @relation(fields: [contentTypeId], references: [id], onDelete: Cascade)
  assignedStep   WorkflowStep? @relation(fields: [assignedStepId], references: [id], onDelete: SetNull)
  fieldValues    RequestFieldValue[]
  
  // Constraints: field name must be unique per content type
  @@unique([contentTypeId, name])
  @@index([contentTypeId])
  @@index([assignedStepId])
  @@map("content_type_field")
}

// RequestFieldValue Model - Stores custom field values for each request
model RequestFieldValue {
  id            String            @id @default(cuid())
  requestId     String
  fieldId       String
  value         Json              // Stores the value (any type as JSON)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  
  // Relations
  request       Request           @relation(fields: [requestId], references: [id], onDelete: Cascade)
  field         ContentTypeField  @relation(fields: [fieldId], references: [id])
  versions      FieldValueVersion[]
  
  // Constraints: one value per field per request
  @@unique([requestId, fieldId])
  @@index([requestId])
  @@index([fieldId])
  @@map("request_field_value")
}

// FieldValueVersion Model - Tracks version history of field value changes
model FieldValueVersion {
  id            String            @id @default(uuid())
  fieldValueId  String
  oldValue      Json?             // Previous value (null if first version)
  newValue      Json              // New value after change
  changedById   String
  stepId        String?           // Which workflow step was active when changed
  createdAt     DateTime          @default(now())
  
  // Relations
  fieldValue    RequestFieldValue @relation(fields: [fieldValueId], references: [id], onDelete: Cascade)
  changedBy     User              @relation(fields: [changedById], references: [id])
  
  // Indexes for efficient querying
  @@index([fieldValueId])
  @@index([changedById])
  @@map("field_value_versions")
}
