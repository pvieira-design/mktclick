// Enums for Request Management
enum RequestStatus {
  DRAFT
  PENDING
  IN_REVIEW
  APPROVED
  REJECTED
  CANCELLED
}

enum Patologia {
  INSONIA
  ANSIEDADE
  DOR
  ESTRESSE
  INFLAMACAO
  OUTRO
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum RequestAction {
  CREATED
  UPDATED
  SUBMITTED
  REVIEW_STARTED
  APPROVED
  REJECTED
  CORRECTED
  CANCELLED
}

// Import models from content-config.prisma
// ContentType and Origin models are defined in content-config.prisma

// Request Model
model Request {
  id              String         @id @default(cuid())
  title           String
  description     String         @db.Text
  contentTypeId   String
  originId        String
  status          RequestStatus  @default(DRAFT)
  priority        Priority       @default(MEDIUM)
  deadline        DateTime?
  patologia       Patologia?
  rejectionReason String?        @db.Text
  createdById     String
  reviewedById    String?
  currentStepId   String?        // Current workflow step
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  // Relations
  contentType           ContentType            @relation(fields: [contentTypeId], references: [id])
  origin                Origin                 @relation(fields: [originId], references: [id])
  createdBy             User                   @relation("RequestCreator", fields: [createdById], references: [id])
  reviewedBy            User?                  @relation("RequestReviewer", fields: [reviewedById], references: [id], onDelete: SetNull)
  currentStep           WorkflowStep?          @relation("CurrentStep", fields: [currentStepId], references: [id])
  history               RequestHistory[]
  fieldValues           RequestFieldValue[]
  creatorParticipations CreatorParticipation[]
  comments              Comment[]
  files                 RequestFile[]

  @@index([contentTypeId])
  @@index([originId])
  @@index([createdById])
  @@index([reviewedById])
  @@index([currentStepId])
  @@index([status])
  @@map("request")
}

// RequestHistory Model
model RequestHistory {
  id        String        @id @default(cuid())
  requestId String
  action    RequestAction
  changedById String
  oldValues Json?
  newValues Json?
  createdAt DateTime      @default(now())

  // Relations
  request   Request @relation(fields: [requestId], references: [id], onDelete: Cascade)
  changedBy User    @relation("HistoryChanger", fields: [changedById], references: [id])

  @@index([requestId])
  @@index([changedById])
  @@map("request_history")
}
