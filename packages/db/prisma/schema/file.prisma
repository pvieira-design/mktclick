// File Library Models

enum TagGroup {
  FILE
  REQUEST
}

model FileFolder {
  id        String   @id @default(cuid())
  name      String
  parentId  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  parent   FileFolder?  @relation("FolderNesting", fields: [parentId], references: [id], onDelete: Cascade)
  children FileFolder[] @relation("FolderNesting")
  files    File[]

  @@index([parentId])
  @@index([createdAt])
  @@map("file_folder")
}

model File {
  id           String   @id @default(cuid())
  name         String
  originalName String
  description  String?  @db.Text
  url          String
  pathname     String
  size         Int
  mimeType     String
  thumbnailUrl String?
  uploadedById String
  creatorId    String?
  originId     String?
  folderId     String?
  isArchived   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  uploadedBy     User            @relation("FileUploader", fields: [uploadedById], references: [id])
  creator        Creator?        @relation("FileCreator", fields: [creatorId], references: [id])
  origin         Origin?         @relation("FileOrigin", fields: [originId], references: [id])
  folder         FileFolder?     @relation(fields: [folderId], references: [id], onDelete: SetNull)
  tags           FileTagOnFile[]
  requests       RequestFile[]
  adCreatives    AdCreativeMedia[]
  adDeliverables AdDeliverable[] @relation("AdDeliverableFile")
  projectImages  AdProjectImage[] @relation("AdProjectImageFile")

  @@index([uploadedById])
  @@index([creatorId])
  @@index([originId])
  @@index([folderId])
  @@index([mimeType])
  @@index([isArchived])
  @@index([createdAt])
  @@map("file")
}

model FileTag {
  id        String   @id @default(cuid())
  name      String   @unique
  color     String   @default("gray")
  group     TagGroup @default(FILE)
  createdAt DateTime @default(now())

  // Relations
  files FileTagOnFile[]

  @@index([group])
  @@map("file_tag")
}

model FileTagOnFile {
  fileId String
  tagId  String

  // Relations
  file File    @relation(fields: [fileId], references: [id], onDelete: Cascade)
  tag  FileTag @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([fileId, tagId])
  @@index([fileId])
  @@index([tagId])
  @@map("file_tag_on_file")
}

model RequestFile {
  requestId String
  fileId    String
  createdAt DateTime @default(now())

  // Relations
  request Request @relation(fields: [requestId], references: [id], onDelete: Cascade)
  file    File    @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@id([requestId, fileId])
  @@index([requestId])
  @@index([fileId])
  @@map("request_file")
}
